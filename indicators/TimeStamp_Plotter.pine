//@version=5
indicator("Custom Date-Time Label + Universal Alert", overlay=true)

// ==========================
// DATE-TIME INPUT
// ==========================
// Use literal numbers directly inside timestamp to satisfy 'const' requirements
targetTime = input.time(defval = timestamp("2026-02-12T14:30:00+05:30"), title = "Select Date & Time")

// ==========================
// HELPER FUNCTION (IST FORMAT)
// ==========================
get_ist_time(_t) => str.format("{0,date,dd-MM-yyyy HH:mm}", _t)

// ==========================
// SYMBOL HELPERS
// ==========================
symbol_raw = syminfo.ticker
chart_link = "chart"

// ==========================
// UNIVERSAL ALERT FUNCTION
// ==========================
sendEvent(_type, _pivotPrice, _confirmPrice, _pivotId) => 
    alert_msg = "{\"num\":\"1\",\"type\":\"" + _type + "\",\"ticker\":\"" + syminfo.ticker + "\",\"symbol_raw\":\"" + symbol_raw + "\",\"pivot_price\":" + str.tostring(_pivotPrice) + ",\"confirm_price\":" + str.tostring(_confirmPrice) + ",\"pivot_id\":\"" + _pivotId + "\",\"confirm_time\":\"" + get_ist_time(time) + "\",\"timestamp\":" + str.tostring(time) + ",\"chart\":\"" + chart_link + "\"}"
    alert(alert_msg, alert.freq_once_per_bar_close)

// ==========================
// TRIGGER CONDITION
// ==========================
// Checks if the current bar's time has reached or passed the target
trigger = (time >= targetTime and time[1] < targetTime)

// ==========================
// EXECUTION
// ==========================
if trigger
    lblText = "ðŸ“Œ Custom Time Hit\nPrice: " + str.tostring(close) + "\nTime: " + get_ist_time(time) + "\nTimestamp: " + str.tostring(time)
    label.new(bar_index, high, lblText, style=label.style_label_down, color=color.yellow, textcolor=color.black)
    sendEvent("CUSTOM_TIME", close, close, "DT_" + str.tostring(targetTime))